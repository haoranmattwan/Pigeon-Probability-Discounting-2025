# Discounting of Probabilistic Food Reinforcement by Pigeons

This repository contains the analysis scripts and figures for the peer-reviewed publication:

> Oliveira, L., Green, L., Myerson, J., & Wan, H. (2025). Discounting of probabilistic food reinforcement by pigeons. *Journal of the Experimental Analysis of Behavior, 124*(1). https://doi.org/10.1002/jeab.70042

The data for this study are publicly available on the Open Science Framework at: <https://osf.io/scwg3/>.

---

## Project Overview

This study examined how pigeons discount probabilistic food rewards using a novel combination of concurrent-chains and adjusting-amount procedures. This ensured that the probabilities experienced by the pigeons matched the programmed probabilities. The primary goals were to determine if the hyperboloid discounting function accurately describes pigeon choice behavior under uncertainty and to investigate the effect of reward magnitude on the degree of discounting.

* **Experiment 1** involved choices between a smaller, certain reward and a larger, probabilistic reward.
* **Experiment 2** extended this to choices between two probabilistic rewards, where the probabilities of both were reduced by a common factor (multiplier).

The analysis relies heavily on Bayesian nonlinear multilevel models implemented via `brms` (in R) and `pymc` (in Python) to estimate subject-level discounting parameters.

## Repository Structure

The project materials are organized into the following folders:

* **/Analysis**: Contains the primary analysis scripts replicating the findings.
    * `analysis_R.qmd`: A Quarto document with the complete **R** code, demonstrating data processing derived from the OSF dataset, fitting custom nonlinear Bayesian beta regression models (`brms`), generating posterior predictions, calculating Bayesian R-squared, and performing amount effect tests (`glmmTMB`).
    * `analysis_Py.ipynb`: A Jupyter Notebook providing a direct **Python** translation of the R analysis, using `pandas` for data handling, `pymc` for Bayesian modeling, `arviz` for results interpretation, and `statsmodels` for auxiliary tests (like GEE).
* **/Figure**: Contains the figures generated by the analysis scripts, matching those in the publication.

---

## Methodology Snapshot

This project showcases advanced statistical modeling techniques applied to behavioral data:

* **Bayesian Nonlinear Multilevel Models**: Custom hyperboloid discounting functions (both standard and generalized for Experiment 2) were implemented within a Bayesian framework to estimate individual subject parameters (`b` and `s`) while accounting for the data structure.
* **Beta Regression**: Used as the observation model (`family = beta_family()`) to appropriately handle the relative subjective value data, which are proportions bounded between 0 and 1.
* **Posterior Predictive Checks & R-squared**: Bayesian R-squared was calculated based on the posterior predictive distribution to assess model fit at the subject level. Posterior predictions were used to generate model-based discounting curves.
* **Area Under the Curve (AuC)**: Calculated as a theory-neutral measure of discounting to compare the effect of reward magnitude across conditions.
* **Generalized Linear Mixed Models / GEE**: `glmmTMB` (R) and `statsmodels.GEE` (Python) were used to test for the effect of reward amount on AuC while accounting for repeated measures within subjects.

---

## Software and Execution

To run the analyses, you will need the appropriate software environment and the data files (`PigeonPD_Exp1.csv`, `PigeonPD_Expt2.csv`) downloaded from the OSF repository linked above.

### R Environment (`/Analysis/analysis_R.qmd`)

* **Required Packages**: `brms`, `cmdstanr`, `tidyverse` (includes `readr`, `dplyr`, `ggplot2`, etc.), `tidybayes`, `bayestestR`, `modelr`, `multcomp`, `glmmTMB`, `broom`, `lemon`, `scales`, `ggpubr`, `here`, `minpack.lm`, `doSNOW`.
* **Installation**:
    ```R
    install.packages(c("brms", "tidyverse", "tidybayes", "bayestestR", "modelr", 
                       "multcomp", "glmmTMB", "broom", "lemon", "scales", 
                       "ggpubr", "here", "minpack.lm", "doSNOW"))
    # brms also requires a working Stan installation via cmdstanr
    # install.packages("cmdstanr", repos = c("[https://mc-stan.org/r-packages/](https://mc-stan.org/r-packages/)", getOption("repos")))
    # cmdstanr::install_cmdstan()
    ```

### Python Environment (`/Analysis/analysis_Py.ipynb`)

* **Required Packages**: `pandas`, `numpy`, `pymc`, `arviz`, `matplotlib`, `seaborn`, `scikit-learn`, `statsmodels`, `jupyter`.
* **Installation**:
    ```bash
    pip install pandas numpy pymc arviz matplotlib seaborn scikit-learn statsmodels jupyter
    ```
